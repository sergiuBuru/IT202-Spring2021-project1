<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    
    <!-- Nav bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a id = "home-nav-item" class="nav-link" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a id="form-nav-item" class="nav-link" href="#">Form</a>
              </li>
              <li class="nav-item">
                <a id="form-data-item" class="nav-link" href="#">Data</a>
              </li>
              <li class="nav-item">
                <a id="form-map-item" class="nav-link" href="#">Map</a>
              </li>
              <li class="nav-item">
                <a id="form-about-item" class="nav-link" href="#">About</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Main container -->
      <div id="body-container" class="container">

      </div>


    <script>
      //------------------------FUNCTIONS------------------------
      var loadHomeScreen = function() {
        removeAllChildNodes(bodyContainer);
        activateNavItem(homeNavItem);
        //description that will be displayed on the Home screen
        var description = document.createElement("p");
        description.innerText = "insert description here";
        bodyContainer.appendChild(description);
      }
      
      //When the page loads mark the home nav item as active.
      //Dinamically display a description of what the app does.
      window.onload = function() {
        activateNavItem(homeNavItem);
        loadHomeScreen();
      }

      //Credit: https://www.javascripttutorial.net/dom/manipulating/remove-all-child-nodes/
      var removeAllChildNodes = function (parent) {
        while (parent.firstChild) {
          parent.removeChild(parent.firstChild);
        }
      }
      
      //Clear the container and add the form to it
      var addForm = function() {
        activateNavItem(form);
        removeAllChildNodes(bodyContainer);
        bodyContainer.appendChild(form);
        formButton = document.querySelector("#form-button");
        formButton.addEventListener("click", returnURL);

        //Retrieve the community area names from the API and append them to the select input
        fetch("https://data.cityofchicago.org/resource/aksk-kvfp.json")
        .then(response => response.json())
        .then( data => {
          console.log(data);
          //Only keep the unique area names.
          //Credit: https://dev.to/marinamosti/removing-duplicates-in-an-array-of-objects-in-js-with-sets-3fep
          const seen = new Set();
          const filteredArr = data.filter(el => {
            const duplicate = seen.has(el["community_area_name"]);
            seen.add(el["community_area_name"]);
            return !duplicate;
          });

          //Sort the objects by the community area name
          filteredArr.sort((a,b) => {
            if (a == b) { return 0; }
            return a["community_area_name"] < b["community_area_name"] ? -1 : 1;
          });

          //Create an option for each area
          for(let area of filteredArr) {
            let opt = document.createElement("option");
            let areaSelect = document.querySelector("#area-select")
            opt.innerText = area["community_area_name"];
            areaSelect.appendChild(opt);
          }
        });
      }
      
      //Make current nav item active and the others inactive
      var activateNavItem = function(item) {
        var navItems = document.querySelectorAll(".nav-link");
        item.classList.add("active");
        navItems.forEach(i => {
          if(i != item) {
            i.classList.remove("active");
          }
        });
      }

      //When the form button is clicked extract the input and fetch the data
      var returnURL = function() {
        console.log("https://data.cityofchicago.org/resource/aksk-kvfp.json" + "?" + "community_area_name=" + document.querySelector("select").value + "%" + "sq_ft=" + document.querySelector("#sq_ft").value);
      } 

      //------------------------OBJECTS------------------------
      // main body container that encapsulates the content for each screen
      var bodyContainer = document.querySelector("#body-container");

      var homeNavItem = document.querySelector("#home-nav-item");

      var formNavItem = document.querySelector("#form-nav-item");

      var areaSelect = document.querySelector("#area-select");

      var formButton;
      
      //Things to include in form: sq_ft, community_area_name
      var form = document.createElement("form");
      form.classList.add("mt-5")
      form.innerHTML = `
        <div class="mb-3">
          <label for="sq_ft" class="form-label">Maximum square feet</label>
          <input id="sq_ft" type="text" class="form-control">
        </div>
        <label for="area-select" class="form-label">Select a community area name</label>
        <select id="area-select" class="form-select" aria-label="Default select example">
        </select>
        <button id="form-button" type="submit" class="mt-3 btn btn-primary">Submit</button>`;
      

      //------------------------EVENT HANDLERS------------------------
      homeNavItem.addEventListener("click", loadHomeScreen);

      formNavItem.addEventListener("click", addForm);
      

    </script>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

  </body>
</html>